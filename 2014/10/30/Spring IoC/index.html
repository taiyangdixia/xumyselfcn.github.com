<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Spring IoC | MingYang&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="MingYang">
  
  
    <meta name="description" content="IoC容器概念
IOC容器就是具有依赖注入功能的容器，IOC容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。应用程序无需直接在代码中new相关的对象，应用程序由IOC容器进行组装。在Spring中BeanFactory是IOC容器的实际代表者。
Bean概念
由IOC容器管理的那些组成你应用程序的对象我们就叫它Bean， Bean就是由Spring容器初始化、装配及管理的对象。">
  
  <meta name="description" content="IoC容器概念
IOC容器就是具有依赖注入功能的容器，IOC容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。应用程序无需直接在代码中new相关的对象，应用程序由IOC容器进行组装。在Spring中BeanFactory是IOC容器的实际代表者。
Bean概念
由IOC容器管理的那些组成你应用程序的对象我们就叫它Bean， Bean就是由Spring容器初始化、装配及管理的对象。">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring IoC">
<meta property="og:url" content="http://blog.xumingyang.cn/2014/10/30/Spring IoC/">
<meta property="og:site_name" content="MingYang's blog">
<meta property="og:description" content="IoC容器概念
IOC容器就是具有依赖注入功能的容器，IOC容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。应用程序无需直接在代码中new相关的对象，应用程序由IOC容器进行组装。在Spring中BeanFactory是IOC容器的实际代表者。
Bean概念
由IOC容器管理的那些组成你应用程序的对象我们就叫它Bean， Bean就是由Spring容器初始化、装配及管理的对象。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring IoC">
<meta name="twitter:description" content="IoC容器概念
IOC容器就是具有依赖注入功能的容器，IOC容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。应用程序无需直接在代码中new相关的对象，应用程序由IOC容器进行组装。在Spring中BeanFactory是IOC容器的实际代表者。
Bean概念
由IOC容器管理的那些组成你应用程序的对象我们就叫它Bean， Bean就是由Spring容器初始化、装配及管理的对象。">

  
    <link rel="alternate" href="/atom.xml" title="MingYang&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'xumyselfcn']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">MingYang&#39;s blog</a></h1>
    <p><a href="/"></a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/about">About</a></li>
      
        <li><a href="http://wiki.xumingyang.cn">Wiki</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/10/30/Spring IoC/">
  <time datetime="2014-10-30T11:22:02.000Z">
    10月 30 2014
  </time>
</a>
    
    
  
    <h1 class="title">Spring IoC</h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="IoC容器概念">IoC容器概念</h3>
<p>IOC容器就是具有依赖注入功能的容器，IOC容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。应用程序无需直接在代码中new相关的对象，应用程序由IOC容器进行组装。在Spring中BeanFactory是IOC容器的实际代表者。</p>
<h3 id="Bean概念">Bean概念</h3>
<p>由IOC容器管理的那些组成你应用程序的对象我们就叫它Bean， Bean就是由Spring容器初始化、装配及管理的对象。</p>
<h3 id="IoC容器使用">IoC容器使用</h3>
<ul>
<li>将被管理的对象定义到spring配置文件中</li>
<li>定义构造函数或者setter方法，让spring将对象注入进去<br><a id="more"></a><h3 id="例子">例子</h3>
必须的jar包：<br>首先是spring核心jar包：<blockquote>
<p>org.springframework.core-3.0.5.RELEASE.jar<br>org.springframework.beans-3.0.5.RELEASE.jar<br>org.springframework.context-3.0.5.RELEASE.jar</p>
</blockquote>
</li>
</ul>
<p>用于log的依赖jar包：</p>
<blockquote>
<p>com.springsource.org.apache.log4j-1.2.15.jar<br>com.springsource.org.apache.commons.logging-1.1.1.jar</p>
</blockquote>
<p>由于这里使用JUnit来进行测试，所有还需要引入jUnit包:</p>
<blockquote>
<p>junit.jar</p>
</blockquote>
<p>包含四个文件：</p>
<ol>
<li>Bean.java</li>
<li>BeanTest.java</li>
<li>applicationContext-bean.xml</li>
<li>log4j.properties</li>
</ol>
<p>Bean.java:</p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> Bean {
    String strValue;
    <span class="keyword">int</span> intValue;
    <span class="keyword">public</span> String <span class="title">getStrValue</span>() {
        <span class="keyword">return</span> strValue;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrValue</span>(String strValue) {
        <span class="keyword">this</span>.strValue = strValue;
    }
    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIntValue</span>() {
        <span class="keyword">return</span> intValue;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIntValue</span>(<span class="keyword">int</span> intValue) {
        <span class="keyword">this</span>.intValue = intValue;
    }
}
</code></pre><p>BeanTest.java</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span> </span>{
    BeanFactory factory;
    <span class="annotation">@Override</span>
    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setUp</span>() <span class="keyword">throws</span> Exception {
        factory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext-*.xml"</span>);
    }

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">injectionTest</span>(){
        Bean bean = (Bean)factory.getBean(<span class="string">"Bean"</span>);
        System.out.println(<span class="string">"bean.strValue "</span> + bean.getStrValue());
        System.out.println(<span class="string">"bean.intValue "</span> + bean.getIntValue());
    }
}
</code></pre><p>applicationContext-bean.xml</p>
<pre><code><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="tag">&lt;<span class="title">beans</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.springframework.org/schema/beans"</span>
         <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="attribute">xmlns:aop</span>=<span class="value">"http://www.springframework.org/schema/aop"</span>
         <span class="attribute">xmlns:tx</span>=<span class="value">"http://www.springframework.org/schema/tx"</span>
         <span class="attribute">xsi:schemaLocation</span>=<span class="value">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd
           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd"</span>&gt;</span>

    <span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"Bean"</span> <span class="attribute">class</span>=<span class="value">"com.xu.spring.Bean"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"strValue"</span> <span class="attribute">value</span>=<span class="value">"hehe"</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"intValue"</span> &gt;</span>
            <span class="tag">&lt;<span class="title">value</span>&gt;</span>11111<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">bean</span>&gt;</span>

<span class="tag">&lt;/<span class="title">beans</span>&gt;</span>
</code></pre><p>log4j.properties</p>
<pre><code># For JBoss: Avoid to setup Log4J outside <span class="variable">$JBOSS_HOME</span>/server/<span class="keyword">default</span>/deploy/log4j.xml!
# For all other servers: Comment out the Log4J listener <span class="keyword">in</span> web.xml to activate Log4J.
log4j.rootLogger=INFO, stdout, logfile

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.<span class="keyword">layout</span>=org.apache.log4j.PatternLayout
log4j.appender.stdout.<span class="keyword">layout</span>.ConversionPattern=<span class="variable">%d</span> <span class="variable">%p</span> [<span class="variable">%c</span>] - <span class="variable">%m</span><span class="variable">%n</span>

log4j.appender.logfile=org.apache.log4j.RollingFileAppender
log4j.appender.logfile.File=${petstore.root}/WEB-INF/petstore.<span class="keyword">log</span>
log4j.appender.logfile.MaxFileSize=<span class="number">512</span>KB
# Keep three backup files.
log4j.appender.logfile.MaxBackupIndex=<span class="number">3</span>
# Pattern to output: <span class="keyword">date</span> priority [category] - message
log4j.appender.logfile.<span class="keyword">layout</span>=org.apache.log4j.PatternLayout
log4j.appender.logfile.<span class="keyword">layout</span>.ConversionPattern=<span class="variable">%d</span> <span class="variable">%p</span> [<span class="variable">%c</span>] - <span class="variable">%m</span><span class="variable">%n</span>
</code></pre><p>在applicationContext-bean.xml中，声明了一个bean标签，里面注入了属性strValue和intValue的值（还可以注入其他类型，比如Map，List等类型）。</p>
<p>在BeanTest.java中setUp函数中初始化的BeanFactory对象，然后在测试函数中就可以通过factory对象获取到Bean中的属性值。</p>
<p>依赖对象的注入方式，可以采用：</p>
<ul>
<li>ref属性</li>
<li><ref>标签</ref></li>
<li>内部<bean>来定义</bean></li>
</ul>
<blockquote>
<p>当涉及到该bean引用另外的bean时，可以使用通过名称或者通过类型进行自动装配。</p>
</blockquote>
<p>还可以将公共的注入定义描述出来：</p>
<ul>
<li>通过<bean>标签定义公共的属性，指定abstract=true</bean></li>
<li>具有相同属性的类在<bean>标签中指定其parent属性</bean></li>
</ul>
<p>可以通过属性编辑器进行特殊类型的注入：</p>
<ul>
<li><p>自定义属性编辑器，spring配置文件中的字符串转换成相应的对象进行注入<br>spring已经有内置的属性编辑器，我们可以根据需求自己定义属性编辑器</p>
</li>
<li><p>如何定义属性编辑器？</p>
<ul>
<li>继承PropertyEditorSupport类，覆写setAsText()方法，参见：UtilDatePropertyEditor.java</li>
<li>将属性编辑器注册到spring中，参见：applicationContext-editor.xml</li>
</ul>
</li>
</ul>

    
  </div>
  <footer>
    
      
      
  <div class="tags">
    <a class="tags-link" href="/tags/spring/">spring</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>


<section id="comment">
  <h1 class="title">评论</h1>
  <div class="ds-thread" data-title="Spring IoC">
  </div>
</section>
</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2014 <a href="/">MingYang</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: 'xumyselfcn' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>